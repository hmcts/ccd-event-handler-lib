language: java

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/

script:
- ./gradlew test
- if [ "$TRAVIS_EVENT_TYPE" == "cron" ]; then ./gradlew -DdependencyCheck.failBuild=true dependencyCheckAnalyze; fi

after_success:
- ./gradlew jacocoTestReport
- bash <(curl -s https://codecov.io/bash)

deploy:
- provider: script
  script: ./gradlew bintrayUpload
  skip_cleanup: true
  on:
    tags: true
    repo: hmcts/bulk-scan-ccd-event-handler-lib

- provider: releases
  api_key:
    secure: fUIJ9A+T3p6hLc6IuL01iHB13vl+1VW2QT90A35VeVjkorFLFOl8IKcoWSG/VyF4kgvUfRSzzh1FozEleXekrh35/9YKJU5z+oyXmQvJ66sr0RoPf7IDRhkMCD71UFFj6iwDoVl9tuuLSA0QMhwoVsK6ZFzEgwUXaAmj3VCslLBqc1fL8jy7rxUFelenKL8Dv26Xgj6KBAYhBljbyNiWL+LNDLwYfkaQxs94DXvWJW+091eF2d9in+gvBAZlCulNd2IBxbFgQOMo0QzgP+AWsXnWyIl3E9eonsnkUxzVzCmSTQf1J0LsskZ4f6ANU4Hiby98B5sRo79ZIBpt4V8TDIeTELSyUms5+41xvcCMLLhFHW/f7zZuV0AzM5g0QoCh+iGykSKYdhBclTEzWrjKLDVqdLH4m9iY9HQf0eO6cQat3kI33ic9HiYkLNZKshFF5AoM83vVjmaauZsDM5O3rX9xQuas4OnL06w/BnQl0VXn5h+kME4XdEAfcVDm8NyLaV9Jl9CPLZZADn3WaVwgKe25rDG0LoDbhBhTfXHozPoDBKvF+gysp9GeSW9wY5dB6kGCq+pBJwMnnFJA74PAjzs9cgLWWBVVCKZiclp22dUZNwZTUsZD6CMM2kRlecg+qtOy6iMzY8SkT76JDTt2AXjI2ATgR1sLA0fu0Y6Ves0=
  file_glob: true
  file: build/libs/bulk-scan-ccd-event-handler-*.jar
  skip_cleanup: true
  on:
    repo: hmcts/bulk-scan-ccd-event-handler-lib
    tags: true

env:
  global:
  - secure: BbeRQZM7zzg5Z19mEREA56qmJWJ7MsZJAwfrZaEsIJuJcjC5wNplWSe+2WnDhfhkHxAg4uvQkuCACzQS70igl9CUzgKGUaGfMkbRZoCrA7jSvt2pKpiMkluymO/uPtY8uSN+jKAaZiGareW9U97doxrJpet+rnPthR/6zFHdT7hP8EaW8hmylfD2t0oSlYPmxk9mGe1vqHJbgWBrswLb4Ia/YRUpYo/4/xHnwKh5jmfSamBitR/pY9UFEjDZmJDJz0KW4VhYXy/4OVi8k2DfmKaN+Yw0c5uB0xFMb/ge9znDJtnKyREIyLToSWHrXF9ge/nAZ3ZTYpHBdfAGNoPlVXiul2UQ9hhGWOi+T/hPHXX2/GpbC344BO6NW+8ZwbGWftYItmBBg/dZex2mazS5hF0vKIQoGKaG8j63bAVetKY1ei9Zf+xUOST9LQHP1MGybXHWRMynruLnf6jldjyHAsTRDqaAW7XtP+Su53y+uAkg2v9FWGGk/UsuI0z9ujKqYQ+orSN2mlZmbAtGyjxxs7z5haDyZ56yUyL11bhrzoZuMwe4EXEqLW+8uQ0MLXOB/ot/To7iKZ8U4wHYjOIErxs6AoA8Qs01f68kB8i7ePfAnHWTzCWzy+m6pvHqd1eUhErquO4yHX/xBS5OmhW8F9z1x1Ns0Jmoph90JA12jXc=
  - secure: VcSN0gcoRjPRj/8H8GlLI2pvb/hjbIise18lUAYHoidj+plSP+5y2ixEPrAG593iMqKJtIMKtK7cGq07bScbvI66HiCqIcKh55q2zYO/kK/tG4dwxrrD6mFypTGl0XKsmyay7c2gFhBxkb8EMX1u6jxc3X21qMics7X6LaAcjkR1U3HeZPcF/noFQUcswcxpH4KxUQ+ddsKFwJFnBukLzwaT0xAofLntJ5hXzzhn5dS6OpdLq0dV3rHcV9a1OPeQqNjjVLtPsoH/k08NGgEY8rytYA6S+vRSuNr0L+TyhbGUdIXyZUTWx1qlvkrtmLKCU4U0QCVB+KEc/ya5yr5IJCIui1OpDA5ktSb1anXCKKeXBJak3nikDK4ijdwE9q88+/kCINQYjZGnc5jNRbjMBa6pl406adXL7aILajy2tx9krVQP7nofuRX/VuvAn+ipulLD2pujdNNbARPZQDd8y+pCtzmSwKCK7v5iG4c2Wl8dZ09pWkRArId58VynC8d2cbQgniQ8N+hRL3FK+SSVkaBK8xr3KgeOaC3m/dIFsOLcO9l86SiDXU88C4RsethDWwWNpt2oxv7Z4ASMvdBQSEvi4/a7n+cAp3cPe4vo/vNziiabWsCCgeAz6X2tZvE8aGfUFCUMx6NWrnW5Qffr2hhqOaGVE8L3XIhaCFaGD6o=
